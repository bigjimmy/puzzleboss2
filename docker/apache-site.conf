<VirtualHost *:80>
    ServerAdmin admin@localhost
    DocumentRoot /app/www

    # PHP Frontend
    <Directory /app/www>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted

        # Enable PHP
        <FilesMatch \.php$>
            SetHandler application/x-httpd-php
        </FilesMatch>

        DirectoryIndex index.php index.html
    </Directory>

    # Proxy API requests to Python backend
    # This allows accessing the API at /api/* in addition to direct :5000 access
    ProxyPreserveHost On
    ProxyPass /api http://localhost:5000
    ProxyPassReverse /api http://localhost:5000

    # Proxy Swagger docs
    ProxyPass /apidocs http://localhost:5000/apidocs
    ProxyPassReverse /apidocs http://localhost:5000/apidocs

    # Proxy metrics endpoint
    ProxyPass /metrics http://localhost:5000/metrics
    ProxyPassReverse /metrics http://localhost:5000/metrics

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>
